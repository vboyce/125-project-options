<html><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
<title>Making Critters</title>
</head> 
<script src="../_shared/js/jquery-1.11.1.min.js" type="text/javascript"></script>
<script src="../_shared/js/raphael-min.js" type="text/javascript"></script>
<script src="../_shared/js/ecosystem.js" type="text/javascript"></script>

<svg id="img1"></svg>
<img id="svg"></img>


<script>

//draws to img1 which is an svg file
var scale = 0.5;
Ecosystem.draw("tree", {"tar1":true, "tar2":true, "prop1":1, "prop2":1}, "img1", scale)

var toImg = function(original) {
var svg;
setTimeout(function(){
	//converts
	function svgDataURL(svg) {
	  var svgAsXML = (new XMLSerializer).serializeToString(svg);
	  return "data:image/svg+xml," + encodeURIComponent(svgAsXML);
	}

	var can = document.createElement('canvas')
	var ctx = can.getContext('2d')
	var targetImage = document.querySelector('#svg')
	svg  = document.querySelector('#'+original)
	var loader = new Image

	console.log(svg)
	console.log(targetImage)

	targetImage.src = svgDataURL(svg);

	// targetImage.width = can.width
	// targetImage.height = can.height
	loader.width = can.width
	loader.height = can.height

	loader.onLoad = function(){
		ctx.drawImage(loader, 0, 0, loader.width, loader.height)
		targetImage.src = can.toDataURL()
	}

	loader.src = svgDataURL(svg)
	// targetImage.style.display = "none"

}, 30)
return svg;
}

toImg("img1")

// try{
//   var sourceImage;
//   var imgs = div.querySelectorAll('img'),
//       svg  = div.querySelector('svg1'),
//       can  = div.querySelector('canvas'),
//       ctx  = can.getContext('2d');
//   can.width  = imgs[1].getAttribute('width')*1;
//   can.height = imgs[1].getAttribute('height')*1;    
//   if (svg){
//     targetImage.src = svgDataURL(svg);
//     sourceImage = new Image;
//     sourceImage.width  = can.width;
//     sourceImage.height = can.height;
//   }else{
//     sourceImage = imgs[0];
//   }
//   sourceImage.onload = function(){
//     ctx.drawImage(sourceImage,0,0,imgs[1].width,imgs[1].height);
//     imgs[1].src = can.toDataURL();
//   };
//   sourceImage.src = svg ? svgDataURL(svg) : div.getAttribute('data-svgSource');
// }catch(e){ console.log(e) }
// });


</script>
</html>
